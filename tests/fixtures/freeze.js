function T(){return{pathname:location.pathname,search:location.search}}function V(){return JSON.parse(sessionStorage.getItem("freeze-cache")??"[]")}function W(k){let x=V();for(let j of x)if(j.cacheKey===k.pathname+k.search)return j;return null}function _(k){let x=document.body.querySelectorAll("a");for(let j of x)j.addEventListener("click",(B)=>{let q=new URL(j.href),H={pathname:q.pathname,search:q.search},J=W(H);if(J){if(B.preventDefault(),Y())Q(k);X(J,H);return}},{once:!0})}var M=new Set;async function X(k,x){document.body.outerHTML=k.content;let j=document.querySelector("title");if(j)j.innerHTML=k.title;else window.document.title=k.title;window.setTimeout(()=>window.scrollTo(0,k.scroll),0),G.clear();for(let B of k.scripts)G.add(B);if(x.pathname==="/")throw new Error("no");await Z(x),history.pushState({freeze:!0},"",x.pathname+x.search)}function Y(){return document.body.hasAttribute("data-freeze")}async function Z(k){if(_(k),Y())await $(k)}var G=new Set;function Q(k){for(let D of M)D?.();M.clear();let x=document.body.outerHTML,j=document.title,B=Array.from(G),q=V(),H=k.pathname+k.search;for(let D=0;D<q.length;D++)if(q[D]?.cacheKey===H){q.splice(D,1);break}let J={content:x,title:j,scripts:B,cacheKey:H,scroll:window.scrollY};q.push(J);while(q.length>0)try{sessionStorage.setItem("freeze-cache",JSON.stringify(q));break}catch{q.shift()}}var I=new AbortController;async function $(k){I.abort(),I=new AbortController,window.addEventListener("freeze:subscribe",(j)=>{if(j.detail)G.add(j.detail)},{signal:I.signal}),await Promise.all(G.values().map((j)=>import(j))),window.dispatchEvent(new CustomEvent("freeze:page-loaded"));let x=await Promise.all(G.values().map((j)=>import(j)));for(let j of x){let B=j.init();M.add(B)}window.addEventListener("beforeunload",()=>Q(k),{signal:I.signal}),window.addEventListener("popstate",(j)=>{if(j.state?.freeze){let B=T(),q=W(B);if(q){Q(k),X(q,B);return}}window.location.reload()},{signal:I.signal})}window.addEventListener("pageshow",()=>{Z(T())});
